angular.module("shortly",["shortly.services","shortly.links","shortly.shorten","shortly.auth","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/signin",{templateUrl:"app/auth/signin.html",controller:"AuthController"}).when("/signup",{templateUrl:"app/auth/signup.html",controller:"AuthController"}).when("/links",{templateUrl:"app/links/links.html",controller:"LinksController",authenticate:!0}).when("/shorten",{templateUrl:"app/shorten/shorten.html",controller:"ShortenController",authenticate:!0}).when("/logout",{authenticate:!1,redirectTo:"/signin"}).otherwise({redirectTo:"/links"}),b.interceptors.push("AttachTokens")}]).factory("AttachTokens",["$window",function(a){var b={request:function(b){var c=a.localStorage.getItem("com.shortly");return c&&(b.headers["x-access-token"]=c),b.headers["Allow-Control-Allow-Origin"]="*",b}};return b}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d,e){d.$$route&&d.$$route.authenticate&&!c.isAuth()&&b.path("/signin")})}]),angular.module("shortly.auth",[]).controller("AuthController",["$scope","$window","$location","Auth",function(a,b,c,d){a.user={},a.error="",a.signin=function(){a.hasError=!1,d.signin(a.user).then(function(a){b.localStorage.setItem("com.shortly",a),c.path("/links")})["catch"](function(b){a.hasError=!0,b&&(console.log(b),a.error=b.data.error.toString(),"No user"===b.data.error.toString()&&(a.error="Wrong password"),setTimeout(function(){a.hasError=!1},2e3))})},a.signup=function(){a.hasError=!1,d.signup(a.user).then(function(a){b.localStorage.setItem("com.shortly",a),c.path("/links")})["catch"](function(b){a.hasError=!0,console.error(b),b&&(a.error="Username already exists. Pick another one!"),setTimeout(function(){a.hasError=!1},2e3)})},a.signOut=function(){d.signout()},a.isAuth=function(){var a=!1;return d.isAuth()&&(a=!0),a}}]),angular.module("shortly.links",[]).controller("LinksController",["$scope","Links",function(a,b){a.data={},a.getLinks=function(){b.getLinks().then(function(b){console.log(b),a.data.links=b})},a.getLinks()}]).directive("ngLink",function(){return{restrict:"E",template:" <div class='link'><img src='../assets/redirect_icon.png'> <div class='info'>  <div class='visits'> <span class='count'> {{link.visits }} </span> Visits </div> <div class ='title'> {{ link.title }}</div> <div class='original'> {{ link.url }}</div> <a href ='{{ link.base_url  + \"/api/links/\" + link.code }}'>{{ link.base_url +  '/' + link.code }}</a> </div> </div>"}}),angular.module("shortly.services",[]).factory("Links",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/links"}).then(function(a){return a.data})},c=function(b){return a({method:"POST",url:"/api/links",data:b}).then(function(a){return console.log("hello",a),a})};return{getLinks:b,addLink:c}}]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return console.log(a),a.data.token})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return console.log(a),a.data.token})},f=function(){return!!c.localStorage.getItem("com.shortly")},g=function(){c.localStorage.removeItem("com.shortly"),b.path("/signin")};return{signin:d,signup:e,isAuth:f,signout:g}}]),angular.module("shortly.shorten",[]).controller("ShortenController",["$scope","$location","Links","Auth",function(a,b,c,d){a.link={},a.addLink=function(){a.loading=!0,c.addLink(a.link).then(function(b){a.loading=!1,console.log("link successfully sent!")})}}]);